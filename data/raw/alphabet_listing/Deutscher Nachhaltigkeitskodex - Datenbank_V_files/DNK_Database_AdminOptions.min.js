function getAdminData(n,t){$("#adminOptions_SelectOptions").css("display","none");$("#adminOptions_ExportTables").css("display","none");$("#admiOptions_PiwikSummary").css("display","none");$("div.checklistFilterBox").css("display","none");$("table.admin_userTable").css("display","none");$("#userVerificationTable").dataTable().fnDestroy();$("#userAccountTable").dataTable().fnDestroy();$("#companyTable").dataTable().fnDestroy();$("#statusTable").dataTable().fnDestroy();$("#criterTable").dataTable().fnDestroy();$("#logTable").dataTable().fnDestroy();$("#eventTable").dataTable().fnDestroy();$.fn.dataTable.ext.search.splice($.fn.dataTable.ext.search.indexOf(myFilterFunction,1));$(".admin").removeClass("active");t.addClass("active");switch(n){case 0:integrateOptions();break;case 1:integrateUsers();break;case 2:integrateCompanies();break;case 3:integrateLog();break;case 4:integratePiwik();break;case 5:integrateVerification();break;case 6:integrateStatus();break;case 7:integrateCriterion();break;case 8:integrateEvents()}}function createDataTable(n,t,i,r,u,f){$.fn.dataTable.moment("DD.MM.YYYY HH:mm");$("#adminOptions_ExportTables").css("display","block");t.css("display","block");t.DataTable({ajax:{url:i,data:r,type:"GET",error:function(n){console.log(n)},dataSrc:""},fnCreatedRow:function(n,t){$(n).addClass(t.rowID)},columns:u,autoWidth:!1,dom:"lBfrtip",initComplete:function(){this.api().columns().every(function(){var t=[],n=this,i=$('<select><option value="">Show all<\/option><\/select>').appendTo($(n.footer()).empty()).on("change",function(){var t=$.fn.dataTable.util.escapeRegex($(this).val());n.search(t?"^"+t+"$":"",!0,!1).draw()});n.data().unique().sort().each(function(n){var r=$("<div/>").html(n).text();jQuery.inArray(r,t)==-1&&(i.append('<option value="'+r+'">'+r+"<\/option>"),t.push(r))})})},buttons:f,deferRender:!0})}function integrateCriterion(){$("#adminOptions_ExportTables").css("display","block");$("div.checklistFilterBox").css("display","block");$("span#criterionFilterButton").on("click",function(){$("#criterTable").dataTable().fnDestroy();var i=$("#criterionFilterDNKNum").val(),r=$("#criterionFilterCheckbox").val(),n=$("#criterionFilterMCE").val(),t=n=="b"?!1:!0;createDataTable("user",$("#criterTable"),"/Home/GetCriterionTable",{dnk:i,box:r,mce:n},[{data:"Unternehmen"},{data:"Branche"},{data:"Jahr"},{data:"Sprache"},{data:"Release"},{data:"Berichtspflicht"},{data:"NAPWiMR"},{data:"G4"},{data:"GRISRS"},{data:"EFFAS"},{data:"Wohnung"},{data:"DNKKriterium"},{data:"DNKChecklist",visible:t},{data:"MCE",visible:t},{data:"Inhalt",visible:!1}],[{extend:"collection",text:"Export",oSelectorOpts:{filter:"applied"},buttons:[{extend:"copy",title:"DNK Kriterium - "+getActualDateString(),exportOptions:{columns:":visible"}},{extend:"excel",title:"DNK Kriterium - "+getActualDateString(),exportOptions:{columns:":visible"}},{extend:"csv",title:"DNK Kriterium - "+getActualDateString(),exportOptions:{columns:":visible"}},{extend:"pdfHtml5",orientation:"portrait",pageSize:"A3",title:"DNK Kriterium - "+getActualDateString()},{extend:"print",title:"DNK Kriterium - "+getActualDateString(),exportOptions:{columns:":visible"}}]},"colvis"])})}function integrateEvents(){createDataTable("event",$("#eventTable"),"/Home/GetEventTable",null,[{data:"Typ"},{data:"Organisator"},{data:"Titel"},{data:"Beginn"},{data:"Ende"},{data:"Visible"},{data:"Options"}],[{extend:"collection",text:"Export",oSelectorOpts:{filter:"applied"},buttons:[{extend:"copy",title:"DNK Events - "+getActualDateString(),exportOptions:{columns:":visible"}},{extend:"excel",title:"DNK Events - "+getActualDateString(),exportOptions:{columns:":visible"}},{extend:"csv",title:"DNK Events - "+getActualDateString(),exportOptions:{columns:":visible"}},{extend:"pdfHtml5",orientation:"portrait",pageSize:"A3",title:"DNK Kriterium - "+getActualDateString()},{extend:"print",title:"DNK Events - "+getActualDateString(),exportOptions:{columns:":visible"}}]},"colvis",{text:"Create event",action:createEvent}])}function createEvent(){editEvent(0,0)}function integrateStatus(){createDataTable("user",$("#statusTable"),"/Home/GetStatusTable",null,[{data:"Unternehmen"},{data:"Branche"},{data:"Jahr"},{data:"Sprache"},{data:"Release"},{data:"Berichtspflicht"},{data:"NAPWiMR"},{data:"G4"},{data:"GRISRS"},{data:"EFFAS"},{data:"Wohnung"},{data:"DNKNummer"},{data:"MCE"},{data:"Anzahl"},{data:"Prozent"}],[{extend:"collection",text:"Export",oSelectorOpts:{filter:"applied"},buttons:[{extend:"copy",title:"DNK Status - "+getActualDateString(),exportOptions:{columns:":visible"}},{extend:"excel",title:"DNK Status - "+getActualDateString(),exportOptions:{columns:":visible"}},{extend:"csv",title:"DNK Status - "+getActualDateString(),exportOptions:{columns:":visible"}},{extend:"pdfHtml5",orientation:"portrait",pageSize:"A3",title:"DNK Status - "+getActualDateString()},{extend:"print",title:"DNK Status - "+getActualDateString(),exportOptions:{columns:":visible"}}]},"colvis"])}function integrateUsers(){createDataTable("user",$("#userAccountTable"),"/Home/GetUserTable",null,[{data:"Aktiv"},{data:"Benutzername"},{data:"Email"},{data:"Unterenhmen"},{data:"LastLogin"},{data:"Freigabe"},{data:"Optionen"}],[{extend:"collection",text:"Export",oSelectorOpts:{filter:"applied"},buttons:[{extend:"copy",title:"DNK User - "+getActualDateString(),exportOptions:{columns:":visible"}},{extend:"excel",title:"DNK User - "+getActualDateString(),exportOptions:{columns:":visible"}},{extend:"csv",title:"DNK User - "+getActualDateString(),exportOptions:{columns:":visible"}},{extend:"pdfHtml5",orientation:"portrait",pageSize:"A3",title:"DNK User - "+getActualDateString()},{extend:"print",title:"DNK User - "+getActualDateString(),exportOptions:{columns:":visible"}}]},"colvis",{text:"Create Account",action:openAccount}])}function saveAccount(n){var r=n.split("_")[2],o=$("div#popupEditAccount textarea#popupContact_name").val(),u=$("div#popupEditAccount input#popupContact_password1").val(),s=$("div#popupEditAccount input#popupContact_password2").val(),f=$("div#popupEditAccount textarea#popupContact_mail").val(),h=[],t;$("div#popupEditAccount select.selectCompany").each(function(){h.push($(this).val())});var e=$("div#popupEditAccount select#selectPermission").val(),c=$("div#popupEditAccount select#popupContact_approved").val(),i=$("div#popupEditAccount textarea#popupContact_kuerzel").val();if(e.indexOf("admin")>-1&&i=="")return alert("Please enter a valid admin sign!"),!1;if(e.indexOf("admin")>-1&&i!=""&&i.length!=2)return alert("The admin sign must contain 2 characters!"),!1;if(o=="")return alert("Please enter a username!"),!1;if(u!=s||u==""||s=="")return alert("The two passwords do not match!"),!1;if(f==""||f.indexOf("@")<=-1)return alert("Please enter a valid email address!"),!1;t={};t.idUser=r;t.name=o;t.psw=u;t.mail=f;t.companyIDs=h;t.permission=e;t.approved=c;t.kuerzel=i;ajaxController("/Account/CreateCompanyAccount",JSON.stringify(t),"POST",function(n){n.indexOf("ERROR")>-1?alert(n):(closePopup("Account"),r==0?(alert("User created!"),$("table#userAccountTable tbody").prepend(n)):(alert("User changed!"),$("table#userAccountTable tbody tr#account_"+r).replaceWith(n)))},"[DNK_DatabaseScript.js]: \n\n> saveAccount() <")}function integrateCompanies(){createDataTable("company",$("#companyTable"),"/Home/GetAllEETable",null,[{data:"unternehmen"},{data:"branche"},{data:"land"},{data:"website"},{data:"groeße"},{data:"boersendotierung"},{data:"berichtsjahr"},{data:"sprache"},{data:"pDF"},{data:"gRI31"},{data:"g4"},{data:"gRISRS"},{data:"eFFAS"},{data:"wohnungsbau"},{data:"status"},{data:"export"},{data:"pruefungDurchDritte"},{data:"freigabeDurch"},{data:"berichtspflichtig"},{data:"NAPWiMR"},{data:"ansprechpartner"},{data:"ansprechpartnerMail"},{data:"companyAdmin"},{data:"companyAdminMail"},{data:"partner"},{data:"missing"},{data:"comply"},{data:"explain"}],[{extend:"collection",text:"Export",oSelectorOpts:{filter:"applied"},buttons:[{extend:"copy",title:"DNK Unternehmen - "+getActualDateString(),exportOptions:{columns:":visible"}},{extend:"excel",title:"DNK Unternehmen - "+getActualDateString(),exportOptions:{columns:":visible"}},{extend:"csv",title:"DNK Unternehmen - "+getActualDateString(),exportOptions:{columns:":visible"}},{extend:"pdfHtml5",orientation:"landscape",pageSize:"A1",title:"DNK Unternehmen - "+getActualDateString(),exportOptions:{columns:":visible"}},{extend:"print",title:"DNK Unternehmen - "+getActualDateString(),exportOptions:{columns:":visible"}}]},"colvis",{text:"Toggle company duplicates",action:showSingleCompanies}])}function showSingleCompanies(){var n=$("#companyTable").DataTable();n.column(6).visible()?($.fn.dataTable.ext.search.push(myFilterFunction),n.draw(),n.column(6).visible(!1),n.column(7).visible(!1),n.column(8).visible(!1),n.column(9).visible(!1),n.column(10).visible(!1),n.column(11).visible(!1),n.column(12).visible(!1),n.column(13).visible(!1),n.column(14).visible(!1),n.column(15).visible(!1),n.column(16).visible(!1),n.column(17).visible(!1),n.column(18).visible(!1),n.column(24).visible(!1),n.column(25).visible(!1),n.column(26).visible(!1)):($.fn.dataTable.ext.search.splice($.fn.dataTable.ext.search.indexOf(myFilterFunction,1)),console.log("Complete list..."),n.draw(),n.column(6).visible(!0),n.column(7).visible(!0),n.column(8).visible(!0),n.column(9).visible(!0),n.column(10).visible(!0),n.column(11).visible(!0),n.column(12).visible(!0),n.column(13).visible(!0),n.column(14).visible(!0),n.column(15).visible(!0),n.column(16).visible(!0),n.column(17).visible(!0),n.column(18).visible(!0),n.column(23).visible(!0),n.column(24).visible(!0),n.column(25).visible(!0));console.log("");console.log(companies)}function integrateLog(){var n=new Date,t=n.getMonth()+1,i=n.getFullYear();createDataTable("log",$("#logTable"),"/Home/GetLogTable",null,[{data:"Datum"},{data:"Eintrag1"},{data:"Eintrag2"},{data:"User"},{data:"Unternehmen"}],[{extend:"collection",text:"Export",oSelectorOpts:{filter:"applied"},buttons:[{extend:"copy",title:"DNK Log - "+getActualDateString(),exportOptions:{columns:":visible"}},{extend:"excel",title:"DNK Log - "+getActualDateString(),exportOptions:{columns:":visible"}},{extend:"csv",title:"DNK Log - "+getActualDateString(),exportOptions:{columns:":visible"}},{extend:"pdfHtml5",orientation:"portrait",pageSize:"A2",title:"DNK Log - "+getActualDateString(),exportOptions:{columns:":visible"}},{extend:"print",title:"DNK Log - "+getActualDateString(),exportOptions:{columns:":visible"}}]},"colvis",{text:"Report for "+t+" / "+i,action:createSummary}])}function createSummary(){var t=new Date,i=t.getMonth()+1,r=t.getFullYear(),n=i;ajaxController("/Home/GetSummary",{month:parseInt(n),mailTo:"",sendAsMail:!1},"GET",function(t){showAlertBox("Monatlicher Report für "+n+" / "+r,t+"<hr><br /><br /><strong>Report per E-Mail versenden?<\/strong><br /><input type='text' id='reportMailAdress' placeholder='Empfänger E-Mail Adresse'><br />",function(){var t=$("input#reportMailAdress").val(),i;validateEmailAdress(t)?(i={month:parseInt(n),mailTo:t,sendAsMail:!0},ajaxController("/Home/GetSummary",i,"GET",function(){hideAlertBox();showAlertBox("Info","Mail erfolgreich versendet!",null,null,"ok")},null,"[DNK_DatabaseScript.js]: \n\n> integrateLog 1() <")):showAlertBox("Error",window["translations_profile_sendMessage_noValidMail_"+database_lang],null,null,"ok")},null,"yesNo")},"[DNK_DatabaseScript.js]: \n\n> integrateLog 2() <")}function integrateVerification(){createDataTable("pruefungen",$("#userVerificationTable"),"/Home/GetPruefungenTable",null,[{data:"Unternehmen"},{data:"Jahr"},{data:"Sprache"},{data:"Pruefer"},{data:"ZweitPruefer"},{data:"Status"},{data:"Anzahl"},{data:"PruefStatus"},{data:"PruefLabel"},{data:"Eingereicht"},{data:"PruefungBis"}],[{extend:"collection",text:"Export",oSelectorOpts:{filter:"applied"},buttons:[{extend:"copy",title:"DNK Prüfungen - "+getActualDateString(),exportOptions:{columns:":visible"}},{extend:"excel",title:"DNK Prüfungen - "+getActualDateString(),exportOptions:{columns:":visible"}},{extend:"csv",title:"DNK Prüfungen - "+getActualDateString(),exportOptions:{columns:":visible"}},{extend:"pdfHtml5",orientation:"portrait",pageSize:"A2",title:"DNK Prüfungen - "+getActualDateString(),exportOptions:{columns:":visible"}},{extend:"print",title:"DNK Prüfungen - "+getActualDateString(),exportOptions:{columns:":visible"}}]},"colvis"])}function integratePiwik(){$("#admiOptions_PiwikSummary").css("display","block");reloadPiwikPictures();$("div#innerAdmin select#selPiwikRange").change(function(){reloadPiwikPictures(!1)});$("div#innerAdmin select#selectPiwikMap").change(function(){reloadPiwikPictures(!1)});$("div#innerAdmin span#searchDate").click(function(){reloadPiwikPictures(!0)});$("#datepicker_from").datepicker({prevText:"◄",prevStatus:"",prevJumpText:"&#x3c;&#x3c;",prevJumpStatus:"",nextText:"►",nextStatus:"",nextJumpText:"&#x3e;&#x3e;",nextJumpStatus:"",currentText:"heute",currentStatus:"",todayText:"heute",todayStatus:"",clearText:"-",clearStatus:"",closeText:"schließen",closeStatus:"",monthNames:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],monthNamesShort:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],dayNames:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],dayNamesShort:["So","Mo","Di","Mi","Do","Fr","Sa"],dayNamesMin:["So","Mo","Di","Mi","Do","Fr","Sa"],showMonthAfterYear:!1,showOn:"both",dateFormat:"dd.mm.yy"});$("#datepicker_to").datepicker({prevText:"◄",prevStatus:"",prevJumpText:"&#x3c;&#x3c;",prevJumpStatus:"",nextText:"►",nextStatus:"",nextJumpText:"&#x3e;&#x3e;",nextJumpStatus:"",currentText:"heute",currentStatus:"",todayText:"heute",todayStatus:"",clearText:"-",clearStatus:"",closeText:"schließen",closeStatus:"",monthNames:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],monthNamesShort:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],dayNames:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],dayNamesShort:["So","Mo","Di","Mi","Do","Fr","Sa"],dayNamesMin:["So","Mo","Di","Mi","Do","Fr","Sa"],showMonthAfterYear:!1,showOn:"both",dateFormat:"dd.mm.yy"})}function showTopTen(){}function reloadPiwikPictures(n){var v=$("select#selPiwikRange").val(),e="",r="",t="",u="",i="",h,c,o,s,k;if(n){h=$("#datepicker_from").val();c=$("#datepicker_to").val();(h==""||c=="")&&alert("Please enter a date into the 'from' and into the 'to' field!");var l=h.split("."),a=c.split("."),y=l[2]+"-"+l[1]+"-"+l[0],p=a[2]+"-"+a[1]+"-"+a[0];r="range";u=y+","+p;t="range";i=y+","+p;$("span.spanTimePeriod").removeClass("active");$("span.choosePiwikPeriod").addClass("active")}else{$("span.spanTimePeriod").addClass("active");$("span.choosePiwikPeriod").removeClass("active");switch(v){case"0":r="month";u="last12";t="year";i="today";break;case"1":r="month";u="last6";var w=new Date,f=monthAdd(w,-6),b=f.getFullYear()+"-"+f.getMonth()+"-"+f.getDate()+",today";t="range";i=b;break;case"2":r="month";u="last3";var w=new Date,f=monthAdd(w,-3),b=f.getFullYear()+"-"+f.getMonth()+"-"+f.getDate()+",today";t="range";i=b;break;case"3":r="day";u="last7";t="week";i="today";break;case"4":r="day";u="yesterday";t="day";i="yesterday";break;case"5":r="day";u="today";t="day";i="today"}}o=$("select#selectPiwikMap").val();o=="1"?(e="https://piwik.com-online.com/index.php?module=Widgetize&action=iframe&widget=1&moduleToWidgetize=UserCountryMap&actionToWidgetize=visitorMap&idSite=151&period="+t+"&date="+i+"&disableLink=1&widget=1&token_auth=6137976faebe0a36db424b8206588bde",$("#piwikInfoContainer").empty().append('<iframe width="100%" height="400" src="'+e+'" scrolling="no" frameborder="0" marginheight="0" marginwidth="0"><\/iframe>')):o=="0"?(e=v<4||n?'<img style="border-bottom: 2px solid #009ee3;padding-bottom: 10px;" src="https://piwik.com-online.com/?module=API&amp;method=ImageGraph.get&amp;idSite=151&amp;apiModule=VisitsSummary&amp;apiAction=get&amp;graphType=evolution&amp;period='+r+"&amp;date="+u+'&amp;width=800&amp;height=180&amp;colors=c7d300&amp;token_auth=6137976faebe0a36db424b8206588bde">':'<img style="border-bottom: 2px solid #009ee3;padding-bottom: 10px;" src="https://piwik.com-online.com/?module=API&amp;method=ImageGraph.get&amp;idSite=151&amp;apiModule=VisitTime&amp;apiAction=getVisitInformationPerLocalTime&amp;graphType=evolution&amp;period='+r+"&amp;date="+u+'&amp;width=800&amp;height=180&amp;colors=c7d300&amp;token_auth=6137976faebe0a36db424b8206588bde">',s='<div style="padding:10px; background-color:#fff;height: 380px;overflow:hidden;">'+e,s+='<div style="float:left;margin-top:10px;padding-right:50px;border-right: 2px solid #009ee3;"><img src="https://piwik.com-online.com/?module=API&amp;method=ImageGraph.get&amp;idSite=151&amp;apiModule=UserCountry&amp;apiAction=getCountry&amp;graphType=horizontalBar&amp;period='+t+"&amp;date="+i+'&amp;width=400&amp;height=180&amp;colors=c7d300&amp;token_auth=6137976faebe0a36db424b8206588bde"><\/div>',s+='<div style="float:right;margin-top:10px;"><img src="https://piwik.com-online.com/?module=API&amp;method=ImageGraph.get&amp;idSite=151&amp;apiModule=DevicesDetection&amp;apiAction=getBrowsers&amp;graphType=horizontalBar&amp;period='+t+"&amp;date="+i+'&amp;width=320&amp;height=180&amp;colors=c7d300&amp;token_auth=6137976faebe0a36db424b8206588bde"><\/div><\/div>',$("#piwikInfoContainer").empty().append(s)):o=="2"&&(k="https://piwik.com-online.com/?module=API&method=Actions.getPageTitles&idSite=151&period="+t+"&date="+i+"&filter_limit=-1&format=xml&token_auth=6137976faebe0a36db424b8206588bde",ajaxController("/Home/GetPiwikPageProperties",{piwikURL:k},"GET",function(n){$("#piwikInfoContainer").empty().append(n)},"[DNK_DatabaseScript.js]: \n\n> reloadPiwikPictures() <"))}function monthAdd(n,t){var i=n;return i=new Date(n.getFullYear(),n.getMonth(),1),i.setMonth(i.getMonth()+(t+1)),i.setDate(i.getDate()-1),n.getDate()<i.getDate()&&i.setDate(n.getDate()),i}function integrateOptions(){$("#adminOptions_SelectOptions").css("display","block")}function newSector_Click(){var t="0"+newSectorVal,n='<tr id="brID_'+t+'">';n+='<td><input class="br_1" type="text" value="" /><\/td>';n+='<td><input class="br_2" type="text" value="" /><\/td>';n+="<\/tr>";$("div#userTable table#table_companySector").append(n);newSectorVal++}function newType_Click(){var t="0"+newTypeVal,n='<tr id="utID_'+t+'">';n+='<td><input class="ut_1" type="text" value="" /><\/td>';n+='<td><input class="ut_2" type="text" value="" /><\/td>';n+="<\/tr>";$("div#userTable table#table_companyType").append(n);newTypeVal++}function saveNewSector_Click(){var n=[];$("table#table_companySector tr").each(function(t,i){if(t>0){var r={idObject:i.id.split("_")[1],name1:$("tr#"+i.id+" td input.br_1").val(),name2:$("tr#"+i.id+" td input.br_2").val()};n.push(r)}});sendNewOptions2DB("/Home/SaveBranchenTable",n)}function saveNewType_Click(){var n=[];$("table#table_companyType tr").each(function(t,i){if(t>0){console.log(i.id);var r={idObject:i.id.split("_")[1],name1:$("tr#"+i.id+" td input.ut_1").val(),name2:$("tr#"+i.id+" td input.ut_2").val()};n.push(r)}});sendNewOptions2DB("/Home/SaveTypeTable",n)}function sendNewOptions2DB(n,t){ajaxController(n,JSON.stringify(t),"POST",function(n){n=="Success"&&(alert("Data saved!"),location.reload())},"[DNK_DatabaseScript.js]: \n\n> sendNewOptions2DB() <")}function exportUserData(){window.open("data:application/vnd.ms-excel;base64,"+$.base64.encode($("div#tableForExport").html()));e.preventDefault()}var company,companies=[],myFilterFunction=function(n,t,i){return companies[i]?!0:(company=t[0],companies.indexOf(company)<0?(companies[i]=company,!0):!1)};